h1. Sample OAuth2 Server Application using Rack::OAuth2 in Rails3

h2. Setup & Run

<pre>
git clone git@github.com:nov/rack-oauth2-sample.git
cd rack-oauth2-sample
bundle install
rake db:migrate
rails server
</pre>

Then go to http://localhost:3000

h2. Client Sample Code

<pre>
require 'rest-client'

base_url      = 'http://rack-oauth2-sample.heroku.com'
redirect_uri  = 'http://client.example.com/callback'
client_id     = SET_YOUR_OWN
client_secret = SET_YOUR_OWN
code          = SET_YOUR_OWN
token         = SET_YOUR_OWN

def url_for(path)
  File.join(base_url, path)
end

begin
  res = RestClient.post url_for('/oauth2/token'), {
    :grant_type => :authorization_code,
    :client_id => client_id,
    :client_secret => client_secret,
    :code => code,
    :redirect_uri => redirect_uri
  }
  p res.body
rescue => e
  p e.response
end

begin
  res = RestClient.post url_for('/protected_resources'), {:oauth_token => token, :data => 'data'}
  p res, res.headers
rescue => e
  p e.response
end

begin
  res = RestClient.get url_for('/protected_resources'), 'Authorization' => "Bearer #{token}"
  p res
rescue => e
  p e.response
end

begin
  res = RestClient.get url_for('/protected_resources/1'), 'Authorization' => "Bearer #{token}"
  p res
rescue => e
  p e.response
end

begin
  res = RestClient.delete url_for('/protected_resources/1'), 'Authorization' => "Bearer #{token}"
  p res
rescue => e
  p e.response
end
</pre>